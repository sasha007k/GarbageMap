@model RouteModel;

@{
    ViewData["Title"] = "Home Page";
}

<head>
    <title></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" />
</head>
<body>
    

</body>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3amkviJ3ysQSwHyFWEZBq2hWrRjobabw&language=en&libraries=places"></script>  

<div id="mapDiv" style="height: 600px;"></div>

@section scripts {
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script
        src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
        integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
        crossorigin="anonymous"></script>

    <script type="text/javascript">

        $(document).ready(function () {
            GetMap();
        });

        function GetMap() {
            var directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true }); 
             var directionsService = new google.maps.DirectionsService();  

            google.maps.visualRefresh = true;
            var Lviv = new google.maps.LatLng(49.8382600, 24.0232400);
            //Create Options or set different Characteristics of Google Map
            var mapOptions = {
                zoom: 14,
                center: Lviv,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: [
                    {
                        "featureType": "poi",
                        "stylers": [
                            { "visibility": "off" }
                        ]
                    }
                ]
            };

            //Display the Google map in the div control with the defined Options
            var map = new google.maps.Map(document.getElementById("mapDiv"), mapOptions);
            directionsDisplay.setMap(map);  
  
            var waypts = [];

            var startPoint = @Html.Raw(Json.Serialize(Model.StartPoint))
            var endPoint = @Html.Raw(Json.Serialize(Model.EndPoint))
            var points = @Html.Raw(Json.Serialize(Model.Points))
            //console.log(items)
            points.forEach(function (point) {
                var locat = point.latitude + "," + point.longitude;
                //console.log(locat)
                waypts.push({ location: locat })
            }) 

            var startCoordinates = startPoint.latitude + "," + startPoint.longitude;
            var endCoordinates = endPoint.latitude + "," + endPoint.longitude;

            var request = {  
                origin: startCoordinates,  
                destination: endCoordinates,  
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.DRIVING  
            };  
            directionsService.route(request, function (response, status) {  
                console.log(status)
                if (status == google.maps.DirectionsStatus.OK) {                      
                    directionsDisplay.setDirections(response);  
                }  
            });       
        }
    </script>
}